<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Fuse Time-Current Curves</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
  <h2 style="text-align:center;">Fuse Time-Current Curves</h2>

  <!-- Dropdown -->
  <div style="text-align:center; margin:20px;">
    <label for="fuseDropdown">Select a Fuse:</label>
    <select id="fuseDropdown"></select>
  </div>

  <!-- Plotly chart -->
  <div id="chart" style="width:90%;height:80%;margin:auto;"></div>

  <script>
    async function loadData() {
      const response = await fetch("fuses.json");
      const data = await response.json();

      const dropdown = document.getElementById("fuseDropdown");

      for (let fuse in data) {
        let option = document.createElement("option");
        option.value = fuse;
        option.text = fuse;
        dropdown.appendChild(option);
      }

      let firstFuse = Object.keys(data)[0];
      plotFuse(firstFuse, data);

      dropdown.addEventListener("change", function() {
        plotFuse(this.value, data);
      });
    }

    function plotFuse(fuseName, data) {
      // Blue line trace
      const traceLine = {
        x: data[fuseName].x,
        y: data[fuseName].y,
        mode: "lines",
        type: "scatter",
        line: {color: "blue"},
        hoverinfo: "none" // we will control hover manually
      };

      // Moving marker trace
      const traceMarker = {
        x: [null], // initially empty
        y: [null],
        mode: "markers",
        type: "scatter",
        marker: {size: 10, color: "red"},
        hovertemplate: "Current: %{x}<br>Time: %{y}<extra></extra>"
      };

      const layout = {
        title: `Time-Current Curve: ${fuseName}`,
        hovermode: "closest",
        xaxis: { title: "Current (A)", type: "log" },
        yaxis: { title: "Time (s)", type: "log" }
      };

      Plotly.newPlot("chart", [traceLine, traceMarker], layout);

      // Add hover event listener to update marker position
      const chart = document.getElementById("chart");
      chart.on("plotly_hover", function(eventData) {
        let x = eventData.points[0].x;
        let y = eventData.points[0].y;

        Plotly.restyle("chart", {
          x: [[x]],
          y: [[y]]
        }, [1]); // Update trace index = 1 (marker trace)
      });

      chart.on("plotly_unhover", function(eventData) {
        Plotly.restyle("chart", {
          x: [[null]],
          y: [[null]]
        }, [1]); // Hide marker when not hovering
      });
    }

    loadData();
  </script>
</body>
</html>
